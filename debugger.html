<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Black Box Breaker â€“ Interactive Algorithm Debugger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --tertiary-bg: #f0f2f5;
            --border-color: #e1e4e8;
            --text-primary: #1a1a1a;
            --text-secondary: #555a5e;
            --text-tertiary: #808a8f;
            --accent: #0366d6;
            --success: #28a745;
            --warning: #fd7e14;
            --danger: #dc3545;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.12);
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                         'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                         sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Header */
        header {
            background-color: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        header p {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background-color: var(--primary-bg);
            border-bottom: 2px solid var(--border-color);
            padding: 0 2rem;
        }

        .tab-button {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-button:hover {
            color: var(--text-primary);
            background-color: var(--tertiary-bg);
        }

        .tab-button.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-button i {
            font-size: 1.1rem;
        }

        /* Main Container */
        .container {
            display: flex;
            height: calc(100vh - 200px);
            overflow: hidden;
            flex-direction: column;
        }

        .tab-container {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-container.active {
            display: flex;
        }

        /* Three Column Layout */
        .three-column {
            display: flex;
            gap: 2rem;
            height: 100%;
            padding: 2rem;
            overflow-y: auto;
        }

        .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .column-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .column-title i {
            color: var(--accent);
            font-size: 1.3rem;
        }

        .column-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 1rem;
        }

        .column-content::-webkit-scrollbar {
            width: 6px;
        }

        .column-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .column-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .column-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Product Card */
        .product-card {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background-color: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .product-card:hover {
            border-color: var(--accent);
            background-color: var(--tertiary-bg);
        }

        .product-card.selected {
            border-color: var(--accent);
            background-color: #e6f0ff;
            font-weight: 600;
        }

        .product-card i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .btn {
            padding: 0.65rem 1.25rem;
            border: 1px solid var(--border-color);
            background-color: var(--secondary-bg);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover:not(:disabled) {
            background-color: var(--tertiary-bg);
            border-color: var(--text-secondary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #0256c7;
            border-color: #0256c7;
        }

        /* Step Card */
        .step-card {
            background-color: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease;
            transition: all 0.2s ease;
        }

        .step-card.active {
            border-color: var(--accent);
            background-color: #e6f0ff;
            box-shadow: var(--shadow-md);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .step-card.active .step-number {
            box-shadow: 0 0 0 4px rgba(3, 102, 214, 0.2);
        }

        .step-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .step-content {
            margin-top: 0.75rem;
            padding-left: 0;
        }

        .step-content-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background-color: var(--primary-bg);
            border-left: 3px solid var(--border-color);
            padding-left: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .step-code {
            background-color: #f5f5f5;
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #d63384;
            margin-top: 0.5rem;
            overflow-x: auto;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--primary-bg);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .data-table th {
            background-color: var(--tertiary-bg);
            padding: 0.75rem;
            text-align: left;
            font-weight: 700;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Right Panel - Data Inspector */
        .inspector-section {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .inspector-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .inspector-title i {
            color: var(--accent);
        }

        .inspector-value {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding: 0.5rem;
            background-color: var(--primary-bg);
            border-left: 3px solid var(--accent);
            padding-left: 0.75rem;
            border-radius: var(--radius-sm);
        }

        .inspector-array {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            word-break: break-all;
            padding: 0.75rem;
            background-color: var(--primary-bg);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            margin-top: 0.5rem;
        }

        /* Text Area */
        textarea {
            width: 100%;
            height: 150px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            color: var(--text-primary);
            background-color: var(--primary-bg);
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-tertiary);
        }

        .empty-state i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }

        /* Sentiment Badge */
        .sentiment-badge {
            display: inline-block;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .sentiment-positive {
            background-color: #d4edda;
            color: #155724;
        }

        .sentiment-negative {
            background-color: #f8d7da;
            color: #721c24;
        }

        .sentiment-neutral {
            background-color: #e2e3e5;
            color: #383d41;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .three-column {
                gap: 1.5rem;
                padding: 1.5rem;
            }

            .column {
                flex: 1.2;
            }
        }

        @media (max-width: 1000px) {
            .three-column {
                flex-direction: column;
                gap: 1.5rem;
            }

            .column {
                flex: auto;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <h1>AI Black Box Breaker</h1>
        <p>Interactive Algorithm Debugger for E-Commerce AI Systems</p>
    </header>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <button class="tab-button active" data-tab="recommendation">
            <i class="fas fa-robot"></i>
            Recommendation Engine Debugger
        </button>
        <button class="tab-button" data-tab="review">
            <i class="fas fa-comments"></i>
            Review Intelligence Debugger
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- TAB 1: Recommendation Engine Debugger -->
        <div id="recommendation" class="tab-container active">
            <div class="three-column">
                <!-- LEFT: Product Selection -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-cube"></i>
                        Product Selection
                    </div>
                    <div class="column-content">
                        <div id="productList"></div>
                    </div>
                </div>

                <!-- CENTER: Algorithm Debugger -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-bug"></i>
                        Algorithm Debugger
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div class="control-buttons">
                            <button class="btn btn-primary" id="recStartBtn" onclick="recDebugger.startDebug()">
                                <i class="fas fa-play"></i>
                                Start Debugging
                            </button>
                            <button class="btn" id="recNextBtn" onclick="recDebugger.nextStep()" disabled>
                                <i class="fas fa-arrow-right"></i>
                                Next Step
                            </button>
                            <button class="btn" id="recResetBtn" onclick="recDebugger.reset()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                        </div>
                    </div>
                    <div class="column-content" id="recDebugSteps"></div>
                </div>

                <!-- RIGHT: Data Inspector -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-database"></i>
                        Live Data Inspector
                    </div>
                    <div class="column-content" id="recInspector"></div>
                </div>
            </div>
        </div>

        <!-- TAB 2: Review Intelligence Debugger -->
        <div id="review" class="tab-container">
            <div class="three-column">
                <!-- LEFT: Review Input -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-pen-fancy"></i>
                        Review Input
                    </div>
                    <div class="column-content">
                        <textarea id="reviewInput" placeholder="Enter a product review here..."></textarea>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-primary" id="reviewStartBtn" onclick="nlpDebugger.startDebug()">
                                <i class="fas fa-play"></i>
                                Start Analysis
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CENTER: NLP Debugger -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-brain"></i>
                        NLP Pipeline Debugger
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div class="control-buttons">
                            <button class="btn" id="nlpNextBtn" onclick="nlpDebugger.nextStep()" disabled>
                                <i class="fas fa-arrow-right"></i>
                                Next Step
                            </button>
                            <button class="btn" id="nlpResetBtn" onclick="nlpDebugger.reset()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                        </div>
                    </div>
                    <div class="column-content" id="nlpDebugSteps"></div>
                </div>

                <!-- RIGHT: Analysis Results -->
                <div class="column">
                    <div class="column-title">
                        <i class="fas fa-chart-pie"></i>
                        Analysis Results
                    </div>
                    <div class="column-content" id="nlpResults"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // COLLABORATIVE FILTERING DATA & UTILITIES
        // ============================================================

        /**
         * Mock dataset for item-to-item collaborative filtering
         * Structure: product name -> {co-purchased item: count}
         * Co-purchase count represents how many users bought both items together
         */
        const coPurchaseData = {
            'Laptop': {
                'Mouse': 45,
                'Keyboard': 37,
                'USB Cable': 28,
                'Monitor': 22,
                'Phone Case': 5
            },
            'Phone': {
                'Phone Case': 82,
                'Charger': 73,
                'Screen Protector': 56,
                'Headphones': 34,
                'Power Bank': 29
            },
            'Shoes': {
                'Socks': 42,
                'Insoles': 18,
                'Sports Watch': 15,
                'Shoe Polish': 12,
                'Running Belt': 8
            },
            'Headphones': {
                'Phone': 34,
                'Audio Cable': 31,
                'Case': 25,
                'Laptop': 22,
                'Stand': 19
            },
            'Watch': {
                'Watch Band': 58,
                'Watch Face Protector': 44,
                'Charger': 16,
                'Sports Shoes': 15,
                'Phone': 12
            }
        };

        // Total purchases per product (denominator in similarity calculation)
        const totalPurchasesPerProduct = {
            'Laptop': 165,
            'Phone': 274,
            'Shoes': 95,
            'Headphones': 131,
            'Watch': 145
        };

        // Product icons for visual representation
        const productIcons = {
            'Laptop': 'fas fa-laptop',
            'Phone': 'fas fa-mobile-alt',
            'Shoes': 'fas fa-shoe-prints',
            'Headphones': 'fas fa-headphones',
            'Watch': 'fas fa-watch'
        };

        // ============================================================
        // NLP & SENTIMENT ANALYSIS UTILITIES
        // ============================================================

        // Stopword list for preprocessing
        const stopwords = new Set([
            'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for',
            'of', 'with', 'by', 'from', 'is', 'was', 'are', 'been', 'be', 'have',
            'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should',
            'it', 'its', 'as', 'if', 'this', 'that', 'these', 'those', 'i', 'me',
            'my', 'you', 'he', 'she', 'we', 'they', 'what', 'which', 'who', 'when'
        ]);

        // Sentiment vocabulary for scoring
        const sentimentLexicon = {
            positive: ['good', 'great', 'excellent', 'amazing', 'fantastic', 'wonderful',
                      'awesome', 'fast', 'quick', 'reliable', 'efficient', 'beautiful',
                      'love', 'perfect', 'best', 'satisfied', 'happy', 'impressed'],
            negative: ['bad', 'terrible', 'awful', 'horrible', 'poor', 'slow',
                      'broken', 'useless', 'waste', 'disappointed', 'worse', 'worst',
                      'late', 'damaged', 'cheap', 'fragile', 'unhappy', 'regret']
        };

        // Aspect mapping for aspect extraction
        const aspectKeywords = {
            'Quality': ['quality', 'material', 'durability', 'build', 'solid', 'sturdy'],
            'Delivery': ['delivery', 'shipping', 'arrived', 'late', 'fast', 'slow', 'package'],
            'Price': ['price', 'expensive', 'cheap', 'cost', 'value', 'worth', 'affordable'],
            'Packaging': ['packaging', 'box', 'wrap', 'presentation', 'unbox']
        };

        // ============================================================
        // RECOMMENDATION ENGINE DEBUGGER CLASS
        // ============================================================

        class RecommendationDebugger {
            constructor() {
                this.selectedProduct = null;
                this.currentStep = 0;
                this.maxSteps = 6;
                this.isDebugActive = false;
                this.debugData = {};
            }

            /**
             * Initialize debugging for a product
             */
            startDebug() {
                if (!this.selectedProduct) {
                    alert('Please select a product first');
                    return;
                }

                this.currentStep = 0;
                this.isDebugActive = true;
                this.debugData = {
                    product: this.selectedProduct,
                    coItems: { ...coPurchaseData[this.selectedProduct] },
                    totalPurchases: totalPurchasesPerProduct[this.selectedProduct],
                    similarities: {},
                    ranked: {}
                };

                this.updateUI();
                this.showStep(0);
            }

            /**
             * Advance to next step in algorithm
             */
            nextStep() {
                if (this.currentStep < this.maxSteps) {
                    this.currentStep++;
                    this.showStep(this.currentStep - 1);
                }

                if (this.currentStep >= this.maxSteps) {
                    document.getElementById('recNextBtn').disabled = true;
                }
            }

            /**
             * Reset debugger state
             */
            reset() {
                this.currentStep = 0;
                this.isDebugActive = false;
                this.debugData = {};
                document.getElementById('recNextBtn').disabled = true;
                document.getElementById('recStartBtn').disabled = false;
                document.getElementById('recDebugSteps').innerHTML = '';
                this.renderInspector();
            }

            /**
             * Display the current algorithm step
             */
            showStep(stepIndex) {
                const stepsContainer = document.getElementById('recDebugSteps');
                let stepHTML = '';

                switch (stepIndex) {
                    case 0:
                        stepHTML = this.renderStep1();
                        break;
                    case 1:
                        stepHTML = this.renderStep2();
                        break;
                    case 2:
                        stepHTML = this.renderStep3();
                        break;
                    case 3:
                        stepHTML = this.renderStep4();
                        break;
                    case 4:
                        stepHTML = this.renderStep5();
                        break;
                    case 5:
                        stepHTML = this.renderStep6();
                        break;
                }

                stepsContainer.innerHTML = stepHTML;
                this.renderInspector();
                document.getElementById('recNextBtn').disabled = false;
            }

            /**
             * STEP 1: User Interaction Captured
             * Display the selected product and metadata
             */
            renderStep1() {
                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">User Interaction Captured</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Event:</strong> User viewed product
                            </div>
                            <div class="step-content-item">
                                <strong>Product:</strong> ${this.selectedProduct}
                            </div>
                            <div class="step-content-item">
                                <strong>Action:</strong> Trigger recommendation algorithm
                            </div>
                            <div class="step-code">
                                selectedProduct = "${this.selectedProduct}"
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * STEP 2: Fetch Co-Purchase Dataset
             * Display the co-purchase relationships from database
             */
            renderStep2() {
                const coItems = this.debugData.coItems;
                let tableHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">Fetch Co-Purchase Dataset</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                Query products frequently bought with: <strong>${this.selectedProduct}</strong>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Co-purchases</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                for (const [item, count] of Object.entries(coItems)) {
                    tableHTML += `<tr><td>${item}</td><td>${count}</td></tr>`;
                }

                tableHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                return tableHTML;
            }

            /**
             * STEP 3: Construct Similarity Matrix
             * Calculate similarity score: coCount / totalPurchases
             */
            renderStep3() {
                const coItems = this.debugData.coItems;
                const total = this.debugData.totalPurchases;
                let matrixHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">Construct Similarity Matrix</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Formula:</strong> similarity = co_purchase_count / total_purchases
                            </div>
                            <div class="step-content-item">
                                <strong>Total Purchases of ${this.selectedProduct}:</strong> ${total}
                            </div>
                `;

                // Store similarity scores for next steps
                this.debugData.similarities = {};
                for (const [item, count] of Object.entries(coItems)) {
                    const similarity = (count / total).toFixed(4);
                    this.debugData.similarities[item] = similarity;
                    matrixHTML += `
                        <div class="step-code">
                            ${item}: ${count} / ${total} = ${similarity}
                        </div>
                    `;
                }

                matrixHTML += `
                        </div>
                    </div>
                `;

                return matrixHTML;
            }

            /**
             * STEP 4: Compute Similarity Scores
             * Display calculated scores in detail
             */
            renderStep4() {
                const similarities = this.debugData.similarities;
                let scoreHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">Compute Similarity Scores</div>
                        </div>
                        <div class="step-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Similarity Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                for (const [item, score] of Object.entries(similarities)) {
                    scoreHTML += `<tr><td>${item}</td><td>${score}</td></tr>`;
                }

                scoreHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                return scoreHTML;
            }

            /**
             * STEP 5: Rank Items by Score
             * Sort items in descending order of similarity
             */
            renderStep5() {
                const similarities = this.debugData.similarities;

                // Sort by similarity score (descending)
                const sorted = Object.entries(similarities)
                    .sort((a, b) => parseFloat(b[1]) - parseFloat(a[1]))
                    .reduce((obj, [key, val]) => { obj[key] = val; return obj; }, {});

                this.debugData.ranked = sorted;

                let rankHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">5</div>
                            <div class="step-title">Rank Items by Score</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                Items sorted by similarity (descending)
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Item</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                let rank = 1;
                for (const [item, score] of Object.entries(sorted)) {
                    rankHTML += `<tr><td>${rank}</td><td>${item}</td><td>${score}</td></tr>`;
                    rank++;
                }

                rankHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                return rankHTML;
            }

            /**
             * STEP 6: Final Recommendation Output
             * Display top 2 recommended products
             */
            renderStep6() {
                const ranked = this.debugData.ranked;
                const topRecommendations = Object.entries(ranked).slice(0, 2);

                let recHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">6</div>
                            <div class="step-title">Final Recommendation Output</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                Returning top 2 recommendations for user
                            </div>
                `;

                topRecommendations.forEach((rec, idx) => {
                    recHTML += `
                        <div class="step-code">
                            [${idx + 1}] Recommend: ${rec[0]} (similarity: ${rec[1]})
                        </div>
                    `;
                });

                recHTML += `
                        </div>
                    </div>
                `;

                return recHTML;
            }

            /**
             * Render the live data inspector panel
             */
            renderInspector() {
                let inspectorHTML = '';

                if (this.isDebugActive) {
                    inspectorHTML = `
                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-cube"></i>
                                Selected Product
                            </div>
                            <div class="inspector-value">${this.debugData.product}</div>
                        </div>

                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-chart-bar"></i>
                                Total Purchases
                            </div>
                            <div class="inspector-value">${this.debugData.totalPurchases} users</div>
                        </div>

                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-layer-group"></i>
                                Co-Purchase Data
                            </div>
                    `;

                    const coString = JSON.stringify(this.debugData.coItems, null, 2);
                    inspectorHTML += `<div class="inspector-array">${coString}</div>`;
                    inspectorHTML += `</div>`;

                    if (Object.keys(this.debugData.similarities).length > 0) {
                        inspectorHTML += `
                            <div class="inspector-section">
                                <div class="inspector-title">
                                    <i class="fas fa-calculator"></i>
                                    Similarity Scores
                                </div>
                        `;

                        const simString = JSON.stringify(this.debugData.similarities, null, 2);
                        inspectorHTML += `<div class="inspector-array">${simString}</div>`;
                        inspectorHTML += `</div>`;
                    }

                    if (Object.keys(this.debugData.ranked).length > 0) {
                        inspectorHTML += `
                            <div class="inspector-section">
                                <div class="inspector-title">
                                    <i class="fas fa-sort-numeric-down"></i>
                                    Ranked Items
                                </div>
                        `;

                        const rankString = JSON.stringify(this.debugData.ranked, null, 2);
                        inspectorHTML += `<div class="inspector-array">${rankString}</div>`;
                        inspectorHTML += `</div>`;
                    }
                } else {
                    inspectorHTML = `
                        <div class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <p>Select a product and click "Start Debugging"</p>
                        </div>
                    `;
                }

                document.getElementById('recInspector').innerHTML = inspectorHTML;
            }

            /**
             * Update UI state based on debugger status
             */
            updateUI() {
                const startBtn = document.getElementById('recStartBtn');
                if (this.isDebugActive) {
                    startBtn.disabled = true;
                } else {
                    startBtn.disabled = false;
                }
            }
        }

        // ============================================================
        // NLP SENTIMENT ANALYSIS DEBUGGER CLASS
        // ============================================================

        class NLPDebugger {
            constructor() {
                this.reviewText = null;
                this.currentStep = 0;
                this.maxSteps = 8;
                this.isAnalysisActive = false;
                this.debugData = {};
            }

            /**
             * Initialize NLP analysis
             */
            startDebug() {
                const reviewInput = document.getElementById('reviewInput');
                this.reviewText = reviewInput.value.trim();

                if (this.reviewText.length === 0) {
                    alert('Please enter a review');
                    return;
                }

                this.currentStep = 0;
                this.isAnalysisActive = true;
                this.debugData = {
                    originalText: this.reviewText
                };

                document.getElementById('nlpNextBtn').disabled = false;
                this.showStep(0);
            }

            /**
             * Advance to next step
             */
            nextStep() {
                if (this.currentStep < this.maxSteps) {
                    this.currentStep++;
                    this.showStep(this.currentStep - 1);
                }

                if (this.currentStep >= this.maxSteps) {
                    document.getElementById('nlpNextBtn').disabled = true;
                }
            }

            /**
             * Reset analysis
             */
            reset() {
                this.currentStep = 0;
                this.isAnalysisActive = false;
                this.debugData = {};
                document.getElementById('nlpNextBtn').disabled = true;
                document.getElementById('nlpDebugSteps').innerHTML = '';
                document.getElementById('nlpResults').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <p>Enter a review and click "Start Analysis"</p>
                    </div>
                `;
            }

            /**
             * Display the current NLP step
             */
            showStep(stepIndex) {
                const stepsContainer = document.getElementById('nlpDebugSteps');
                let stepHTML = '';

                switch (stepIndex) {
                    case 0:
                        stepHTML = this.renderNLPStep1();
                        break;
                    case 1:
                        stepHTML = this.renderNLPStep2();
                        break;
                    case 2:
                        stepHTML = this.renderNLPStep3();
                        break;
                    case 3:
                        stepHTML = this.renderNLPStep4();
                        break;
                    case 4:
                        stepHTML = this.renderNLPStep5();
                        break;
                    case 5:
                        stepHTML = this.renderNLPStep6();
                        break;
                    case 6:
                        stepHTML = this.renderNLPStep7();
                        break;
                    case 7:
                        stepHTML = this.renderNLPStep8();
                        break;
                }

                stepsContainer.innerHTML = stepHTML;
                this.renderNLPResults();
            }

            /**
             * STEP 1: Raw Input Text
             */
            renderNLPStep1() {
                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">Raw Input Text</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                ${this.reviewText}
                            </div>
                            <div class="step-code">
                                length: ${this.reviewText.length} characters
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * STEP 2: Lowercase Conversion
             */
            renderNLPStep2() {
                const lowercase = this.reviewText.toLowerCase();
                this.debugData.lowercase = lowercase;

                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">Lowercase Conversion</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Operation:</strong> Convert all text to lowercase
                            </div>
                            <div class="step-code">
                                text.toLowerCase()
                            </div>
                            <div class="step-content-item" style="margin-top: 1rem;">
                                ${lowercase}
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * STEP 3: Remove Punctuation
             */
            renderNLPStep3() {
                const noPunct = this.debugData.lowercase.replace(/[^\w\s]/g, '');
                this.debugData.noPunctuation = noPunct;

                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">Remove Punctuation</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Operation:</strong> Remove special characters
                            </div>
                            <div class="step-code">
                                text.replace(/[^\\w\\s]/g, '')
                            </div>
                            <div class="step-content-item" style="margin-top: 1rem;">
                                ${noPunct}
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * STEP 4: Remove Stopwords
             */
            renderNLPStep4() {
                const tokens = this.debugData.noPunctuation.split(/\s+/).filter(t => t.length > 0);
                const filtered = tokens.filter(t => !stopwords.has(t));
                this.debugData.tokensAfterStopwords = filtered;

                let removedStopwords = tokens.filter(t => stopwords.has(t));

                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">Remove Stopwords</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Stopwords removed:</strong> ${removedStopwords.length}
                            </div>
                            <div class="step-code">
                                ${removedStopwords.join(', ') || '(none)'}
                            </div>
                            <div class="step-content-item" style="margin-top: 1rem;">
                                <strong>Remaining tokens:</strong> ${filtered.length}
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * STEP 5: Tokenization
             * Display the array of tokens
             */
            renderNLPStep5() {
                const tokens = this.debugData.tokensAfterStopwords;
                this.debugData.tokens = tokens;

                let tokenHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">5</div>
                            <div class="step-title">Tokenization</div>
                        </div>
                        <div class="step-content">
                            <div class="step-code">
                                tokens = [${tokens.map(t => `"${t}"`).join(', ')}]
                            </div>
                            <div class="step-content-item" style="margin-top: 1rem;">
                                <strong>Total tokens:</strong> ${tokens.length}
                            </div>
                        </div>
                    </div>
                `;

                return tokenHTML;
            }

            /**
             * STEP 6: Sentiment Scoring
             * Calculate sentiment score using keyword-based approach
             */
            renderNLPStep6() {
                const tokens = this.debugData.tokens;
                let score = 0;
                const foundPositive = [];
                const foundNegative = [];

                // Count positive words
                tokens.forEach(token => {
                    if (sentimentLexicon.positive.includes(token)) {
                        foundPositive.push(token);
                        score += 1;
                    }
                });

                // Count negative words
                tokens.forEach(token => {
                    if (sentimentLexicon.negative.includes(token)) {
                        foundNegative.push(token);
                        score -= 1;
                    }
                });

                this.debugData.sentimentScore = score;
                this.debugData.positiveWords = foundPositive;
                this.debugData.negativeWords = foundNegative;

                let scoreHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">6</div>
                            <div class="step-title">Sentiment Scoring</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Algorithm:</strong> Bag-of-Words Sentiment
                            </div>
                            <div class="step-code">
                                score = 0
                            </div>
                `;

                if (foundPositive.length > 0) {
                    scoreHTML += `
                        <div class="step-content-item">
                            <strong>Positive words found:</strong> ${foundPositive.length}
                        </div>
                    `;
                    foundPositive.forEach(word => {
                        scoreHTML += `
                            <div class="step-code">
                                score += 1  (found: "${word}")
                            </div>
                        `;
                    });
                }

                if (foundNegative.length > 0) {
                    scoreHTML += `
                        <div class="step-content-item">
                            <strong>Negative words found:</strong> ${foundNegative.length}
                        </div>
                    `;
                    foundNegative.forEach(word => {
                        scoreHTML += `
                            <div class="step-code">
                                score -= 1  (found: "${word}")
                            </div>
                        `;
                    });
                }

                scoreHTML += `
                        <div class="step-code" style="margin-top: 1rem;">
                            <strong>Final score:</strong> ${score}
                        </div>
                        </div>
                    </div>
                `;

                return scoreHTML;
            }

            /**
             * STEP 7: Aspect Detection
             * Map tokens to predefined aspects
             */
            renderNLPStep7() {
                const tokens = this.debugData.tokens;
                const detectedAspects = {};

                for (const aspect in aspectKeywords) {
                    const keywords = aspectKeywords[aspect];
                    const found = tokens.filter(t => keywords.includes(t));

                    if (found.length > 0) {
                        detectedAspects[aspect] = found;
                    }
                }

                this.debugData.detectedAspects = detectedAspects;

                let aspectHTML = `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">7</div>
                            <div class="step-title">Aspect Detection</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Mapping tokens to product aspects</strong>
                            </div>
                `;

                if (Object.keys(detectedAspects).length === 0) {
                    aspectHTML += `
                        <div class="step-content-item">
                            No recognizable aspects found in review.
                        </div>
                    `;
                } else {
                    for (const aspect in detectedAspects) {
                        const keywords = detectedAspects[aspect];
                        aspectHTML += `
                            <div class="step-code">
                                ${aspect}: [${keywords.map(k => `"${k}"`).join(', ')}]
                            </div>
                        `;
                    }
                }

                aspectHTML += `
                        </div>
                    </div>
                `;

                return aspectHTML;
            }

            /**
             * STEP 8: Insight Generation
             * Create human-readable summary
             */
            renderNLPStep8() {
                const score = this.debugData.sentimentScore;
                const aspects = this.debugData.detectedAspects;

                let classification = 'Neutral';
                if (score > 0) classification = 'Positive';
                if (score < 0) classification = 'Negative';

                this.debugData.classification = classification;

                let insight = 'Unable to generate insight.';

                if (Object.keys(aspects).length > 0) {
                    const positiveAspects = [];
                    const negativeAspects = [];

                    for (const aspect in aspects) {
                        const keywords = aspects[aspect];
                        let aspectScore = 0;

                        keywords.forEach(kw => {
                            if (sentimentLexicon.positive.includes(kw)) aspectScore += 1;
                            if (sentimentLexicon.negative.includes(kw)) aspectScore -= 1;
                        });

                        if (aspectScore > 0) positiveAspects.push(aspect);
                        if (aspectScore < 0) negativeAspects.push(aspect);
                    }

                    if (positiveAspects.length > 0 || negativeAspects.length > 0) {
                        insight = 'Customers ';
                        if (positiveAspects.length > 0) {
                            insight += `appreciate ${positiveAspects.join(' and ')}`;
                        }
                        if (negativeAspects.length > 0) {
                            if (positiveAspects.length > 0) {
                                insight += ' but are dissatisfied with ';
                            } else {
                                insight += 'are dissatisfied with ';
                            }
                            insight += negativeAspects.join(' and ');
                        }
                        insight += '.';
                    } else {
                        insight = `Overall sentiment is ${classification}.`;
                    }
                }

                this.debugData.insight = insight;

                return `
                    <div class="step-card active">
                        <div class="step-header">
                            <div class="step-number">8</div>
                            <div class="step-title">Insight Generation</div>
                        </div>
                        <div class="step-content">
                            <div class="step-content-item">
                                <strong>Classification:</strong> ${classification}
                            </div>
                            <div class="step-content-item">
                                <strong>Score:</strong> ${score}
                            </div>
                            <div class="step-content-item" style="margin-top: 1rem;">
                                <strong>Generated Insight:</strong>
                            </div>
                            <div class="step-code">
                                "${insight}"
                            </div>
                        </div>
                    </div>
                `;
            }

            /**
             * Render structured analysis results
             */
            renderNLPResults() {
                let resultsHTML = '';

                if (this.isAnalysisActive && Object.keys(this.debugData).length > 1) {
                    const classification = this.debugData.classification || 'Neutral';
                    const score = this.debugData.sentimentScore !== undefined ? this.debugData.sentimentScore : 0;
                    const aspects = this.debugData.detectedAspects || {};
                    const insight = this.debugData.insight || '';

                    const sentimentClass = classification === 'Positive' ? 'sentiment-positive' :
                                          classification === 'Negative' ? 'sentiment-negative' :
                                          'sentiment-neutral';

                    resultsHTML = `
                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-heart"></i>
                                Sentiment Classification
                            </div>
                            <div class="sentiment-badge ${sentimentClass}">
                                ${classification}
                            </div>
                        </div>

                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-equals"></i>
                                Sentiment Score
                            </div>
                            <div class="inspector-value">${score}</div>
                        </div>

                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-tags"></i>
                                Detected Aspects
                            </div>
                    `;

                    if (Object.keys(aspects).length === 0) {
                        resultsHTML += `<div style="color: #999; font-style: italic;">None detected</div>`;
                    } else {
                        for (const aspect in aspects) {
                            const keywords = aspects[aspect];
                            resultsHTML += `
                                <div class="inspector-value">
                                    <strong>${aspect}</strong><br>
                                    ${keywords.join(', ')}
                                </div>
                            `;
                        }
                    }

                    resultsHTML += `
                        </div>

                        <div class="inspector-section">
                            <div class="inspector-title">
                                <i class="fas fa-lightbulb"></i>
                                Generated Insight
                            </div>
                            <div class="inspector-value">
                                "${insight}"
                            </div>
                        </div>
                    `;
                } else {
                    resultsHTML = `
                        <div class="empty-state">
                            <i class="fas fa-comments"></i>
                            <p>Results will appear here</p>
                        </div>
                    `;
                }

                document.getElementById('nlpResults').innerHTML = resultsHTML;
            }
        }

        // ============================================================
        // INSTANTIATE DEBUGGERS
        // ============================================================

        const recDebugger = new RecommendationDebugger();
        const nlpDebugger = new NLPDebugger();

        // ============================================================
        // TAB SWITCHING
        // ============================================================

        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');

                // Update button state
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-container').forEach(container => {
                    container.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            });
        });

        // ============================================================
        // PRODUCT SELECTION FOR RECOMMENDATION ENGINE
        // ============================================================

        function initializeProductList() {
            const productList = document.getElementById('productList');
            const products = ['Laptop', 'Phone', 'Shoes', 'Headphones', 'Watch'];

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <i class="${productIcons[product]}"></i>
                    ${product}
                `;

                card.addEventListener('click', () => {
                    // Update selection
                    document.querySelectorAll('.product-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    card.classList.add('selected');

                    // Set debugger product
                    recDebugger.selectedProduct = product;
                    recDebugger.reset();
                    document.getElementById('recStartBtn').disabled = false;
                });

                productList.appendChild(card);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeProductList();
            recDebugger.renderInspector();
            nlpDebugger.renderNLPResults();
        });
    </script>
</body>
</html>
